(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,20333,e=>{"use strict";var s=e.i(43476),a=e.i(932),t=e.i(71645),l=e.i(70952);e.i(70272);var n=e.i(98552);let i=e=>{let t,l,n,i,d,r,c,o,m,u,b,h,x,p,j,g,v,N,y,f,_,k,w,S,C,R,O,K,T,A,B,D,L,$,M,q,W,Y,z,U,E,F=(0,a.c)(78),{filters:H,total:I,loading:P,onFiltersChange:Q,onRefresh:V}=e;F[0]!==H||F[1]!==Q?(t=e=>s=>{Q({...H,[e]:s.target.value})},F[0]=H,F[1]=Q,F[2]=t):t=F[2];let Z=t;F[3]===Symbol.for("react.memo_cache_sentinel")?(l={minWidth:0,flex:2},F[3]=l):l=F[3],F[4]===Symbol.for("react.memo_cache_sentinel")?(n=(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("h5",{className:"mb-0 small fw-semibold",children:"Randevular"}),(0,s.jsx)("div",{className:"text-muted small",children:"Filtrele, görüntüle ve durum güncelle."})]}),F[4]=n):n=F[4],F[5]===Symbol.for("react.memo_cache_sentinel")?(i=(0,s.jsx)("label",{className:"form-label small mb-1",children:"Arama"}),F[5]=i):i=F[5];let G=H.q;F[6]!==Z?(d=Z("q"),F[6]=Z,F[7]=d):d=F[7],F[8]!==H.q||F[9]!==d?(r=(0,s.jsxs)("div",{className:"col-md-4",children:[i,(0,s.jsx)("input",{type:"search",className:"form-control form-control-sm",placeholder:"İsim / Email / Telefon",value:G,onChange:d})]}),F[8]=H.q,F[9]=d,F[10]=r):r=F[10],F[11]===Symbol.for("react.memo_cache_sentinel")?(c=(0,s.jsx)("label",{className:"form-label small mb-1",children:"Durum"}),F[11]=c):c=F[11];let J=H.status;F[12]!==Z?(o=Z("status"),F[12]=Z,F[13]=o):o=F[13],F[14]===Symbol.for("react.memo_cache_sentinel")?(m=(0,s.jsx)("option",{value:"all",children:"Hepsi"}),u=(0,s.jsx)("option",{value:"new",children:"Yeni"}),b=(0,s.jsx)("option",{value:"confirmed",children:"Onaylandı"}),h=(0,s.jsx)("option",{value:"rejected",children:"Reddedildi"}),x=(0,s.jsx)("option",{value:"completed",children:"Tamamlandı"}),p=(0,s.jsx)("option",{value:"cancelled",children:"İptal"}),j=(0,s.jsx)("option",{value:"expired",children:"Süresi Doldu"}),F[14]=m,F[15]=u,F[16]=b,F[17]=h,F[18]=x,F[19]=p,F[20]=j):(m=F[14],u=F[15],b=F[16],h=F[17],x=F[18],p=F[19],j=F[20]),F[21]!==H.status||F[22]!==o?(g=(0,s.jsxs)("div",{className:"col-md-2",children:[c,(0,s.jsxs)("select",{className:"form-select form-select-sm",value:J,onChange:o,children:[m,u,b,h,x,p,j]})]}),F[21]=H.status,F[22]=o,F[23]=g):g=F[23],F[24]===Symbol.for("react.memo_cache_sentinel")?(v=(0,s.jsx)("label",{className:"form-label small mb-1",children:"Okunma"}),F[24]=v):v=F[24];let X=H.is_read;F[25]!==Z?(N=Z("is_read"),F[25]=Z,F[26]=N):N=F[26],F[27]===Symbol.for("react.memo_cache_sentinel")?(y=(0,s.jsx)("option",{value:"all",children:"Hepsi"}),f=(0,s.jsx)("option",{value:"unread",children:"Okunmadı"}),_=(0,s.jsx)("option",{value:"read",children:"Okundu"}),F[27]=y,F[28]=f,F[29]=_):(y=F[27],f=F[28],_=F[29]),F[30]!==H.is_read||F[31]!==N?(k=(0,s.jsxs)("div",{className:"col-md-2",children:[v,(0,s.jsxs)("select",{className:"form-select form-select-sm",value:X,onChange:N,children:[y,f,_]})]}),F[30]=H.is_read,F[31]=N,F[32]=k):k=F[32],F[33]===Symbol.for("react.memo_cache_sentinel")?(w=(0,s.jsx)("label",{className:"form-label small mb-1",children:"Tarih"}),F[33]=w):w=F[33];let ee=H.appointment_date;F[34]!==Z?(S=Z("appointment_date"),F[34]=Z,F[35]=S):S=F[35],F[36]!==H.appointment_date||F[37]!==S?(C=(0,s.jsxs)("div",{className:"col-md-2",children:[w,(0,s.jsx)("input",{type:"date",className:"form-control form-control-sm",value:ee,onChange:S})]}),F[36]=H.appointment_date,F[37]=S,F[38]=C):C=F[38],F[39]===Symbol.for("react.memo_cache_sentinel")?(R=(0,s.jsx)("label",{className:"form-label small mb-1",children:"Kaynak"}),F[39]=R):R=F[39];let es=H.resource_id;F[40]!==Z?(O=Z("resource_id"),F[40]=Z,F[41]=O):O=F[41],F[42]!==H.resource_id||F[43]!==O?(K=(0,s.jsxs)("div",{className:"col-md-1",children:[R,(0,s.jsx)("input",{className:"form-control form-control-sm",value:es,onChange:O,placeholder:"(ops.)"})]}),F[42]=H.resource_id,F[43]=O,F[44]=K):K=F[44],F[45]===Symbol.for("react.memo_cache_sentinel")?(T=(0,s.jsx)("label",{className:"form-label small mb-1",children:"Servis"}),F[45]=T):T=F[45];let ea=H.service_id;return F[46]!==Z?(A=Z("service_id"),F[46]=Z,F[47]=A):A=F[47],F[48]!==H.service_id||F[49]!==A?(B=(0,s.jsxs)("div",{className:"col-md-1",children:[T,(0,s.jsx)("input",{className:"form-control form-control-sm",value:ea,onChange:A,placeholder:"(ops.)"})]}),F[48]=H.service_id,F[49]=A,F[50]=B):B=F[50],F[51]!==g||F[52]!==k||F[53]!==C||F[54]!==K||F[55]!==B||F[56]!==r?(D=(0,s.jsxs)("div",{style:l,children:[n,(0,s.jsxs)("div",{className:"row g-2 align-items-end",children:[r,g,k,C,K,B]})]}),F[51]=g,F[52]=k,F[53]=C,F[54]=K,F[55]=B,F[56]=r,F[57]=D):D=F[57],F[58]===Symbol.for("react.memo_cache_sentinel")?(L={minWidth:0,flex:1},F[58]=L):L=F[58],F[59]===Symbol.for("react.memo_cache_sentinel")?($=(0,s.jsx)("div",{className:"small fw-semibold",children:"Toplam"}),F[59]=$):$=F[59],F[60]!==I?(M=(0,s.jsxs)("div",{children:[$,(0,s.jsx)("div",{className:"display-6 fs-4 fw-bold",children:I})]}),F[60]=I,F[61]=M):M=F[61],F[62]!==P||F[63]!==V?(q=V?(0,s.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:V,disabled:P,children:"Yenile"}):null,F[62]=P,F[63]=V,F[64]=q):q=F[64],F[65]!==M||F[66]!==q?(W=(0,s.jsxs)("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[M,q]}),F[65]=M,F[66]=q,F[67]=W):W=F[67],F[68]!==P?(Y=P?(0,s.jsx)("span",{className:"badge bg-secondary small",children:"Yükleniyor..."}):null,F[68]=P,F[69]=Y):Y=F[69],F[70]!==Y?(z=(0,s.jsx)("div",{className:"d-flex justify-content-end",children:Y}),F[70]=Y,F[71]=z):z=F[71],F[72]!==W||F[73]!==z?(U=(0,s.jsxs)("div",{className:"border-start ps-lg-3 ms-lg-3 d-flex flex-column justify-content-between",style:L,children:[W,z]}),F[72]=W,F[73]=z,F[74]=U):U=F[74],F[75]!==D||F[76]!==U?(E=(0,s.jsx)("div",{className:"card mb-3",children:(0,s.jsx)("div",{className:"card-body py-3",children:(0,s.jsxs)("div",{className:"d-flex flex-column flex-lg-row justify-content-between gap-3",children:[D,U]})})}),F[75]=D,F[76]=U,F[77]=E):E=F[77],E};var d=e.i(22016),r=e.i(46696);let c=(e,s)=>{let a=String(e||"").trim(),t=String(s||"").trim();return a||t?a&&t?`${a} ${t}`:a||t:"-"},o=e=>null==e?"":String(e),m=e=>{let s=String(e||"").toLowerCase();return"new"===s?"Yeni":"confirmed"===s?"Onaylandı":"completed"===s?"Tamamlandı":"rejected"===s?"Reddedildi":"cancelled"===s?"İptal":"expired"===s?"Süresi Doldu":s?String(e):"-"},u=e=>{let s=String(e||"").toLowerCase();return"new"===s?"bg-primary-subtle text-primary border border-primary-subtle":"confirmed"===s?"bg-success-subtle text-success border border-success-subtle":"completed"===s?"bg-secondary-subtle text-secondary border border-secondary-subtle":"rejected"===s?"bg-warning-subtle text-warning border border-warning-subtle":"cancelled"===s?"bg-danger-subtle text-danger border border-danger-subtle":"expired"===s?"bg-dark-subtle text-dark border border-dark-subtle":"bg-light text-dark border"},b=e=>"new"===String(e.status||"").toLowerCase(),h=e=>{let s=String(e.status||"").toLowerCase();return"new"===s||"confirmed"===s},x=({items:e,loading:a})=>{let l=e??[],i=l.length>0,[x,{isLoading:p}]=(0,n.useDeleteBookingAdminMutation)(),[j,{isLoading:g}]=(0,n.useMarkBookingReadAdminMutation)(),[v,{isLoading:N}]=(0,n.useAcceptBookingAdminMutation)(),[y,{isLoading:f}]=(0,n.useRejectBookingAdminMutation)(),_=a||p||g||N||f,[k,w]=(0,t.useState)("table"),[S,C]=(0,t.useState)(!1),[R,O]=(0,t.useState)("accept"),[K,T]=(0,t.useState)(null),[A,B]=(0,t.useState)(""),D=(e,s)=>{O(e),T(s),B(String(s?.decision_note??"").trim()),C(!0)},L=()=>{C(!1),T(null),B("")},$=async e=>{if(window.confirm(`Bu randevu kaydını silmek \xfczeresin.

M\xfcşteri: ${e.name||"-"}
Tarih: ${c(e.appointment_date,e.appointment_time)}

Devam etmek istiyor musun?`))try{await x(e.id).unwrap(),r.toast.success("Randevu silindi.")}catch(e){r.toast.error(e?.data?.error?.message||e?.message||"Silme sırasında hata oluştu.")}},M=async e=>{try{await j(e.id).unwrap(),r.toast.success("Okundu olarak işaretlendi.")}catch(e){r.toast.error(e?.data?.error?.message||e?.message||"İşlem sırasında hata oluştu.")}},q=async()=>{if(!K)return;let e=String(A||"").trim();try{if("accept"===R)await v({id:K.id,body:e?{decision_note:e}:{}}).unwrap(),r.toast.success("Randevu kabul edildi. (Email + bildirim tetiklendi)");else{if(!window.confirm("Randevuyu reddetmek üzeresin. Devam edilsin mi?"))return;await y({id:K.id,body:e?{decision_note:e}:{}}).unwrap(),r.toast.success("Randevu reddedildi. (Email + bildirim tetiklendi)")}L()}catch(e){r.toast.error(e?.data?.error?.message||e?.message||"İşlem sırasında hata oluştu.")}},W=()=>a?(0,s.jsx)("div",{className:"text-muted small p-3",children:"Yükleniyor..."}):(0,s.jsx)("div",{className:"text-muted small p-3",children:"Kayıt bulunamadı."}),Y=()=>S&&K?(0,s.jsx)("div",{className:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.35)"},role:"dialog","aria-modal":"true",children:(0,s.jsx)("div",{className:"modal-dialog modal-dialog-centered",children:(0,s.jsxs)("div",{className:"modal-content",children:[(0,s.jsxs)("div",{className:"modal-header py-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"fw-semibold",children:"accept"===R?"Randevu Kabul":"Randevu Red"}),(0,s.jsxs)("div",{className:"text-muted small",children:[K.name||"-"," • ",c(K.appointment_date,K.appointment_time)]})]}),(0,s.jsx)("button",{type:"button",className:"btn-close",onClick:L})]}),(0,s.jsxs)("div",{className:"modal-body",children:[(0,s.jsx)("label",{className:"form-label small mb-1",children:"Decision Note (opsiyonel)"}),(0,s.jsx)("textarea",{className:"form-control",rows:4,value:A,onChange:e=>B(e.target.value),disabled:_,placeholder:"Müşteriye gidecek template içinde gösterilebilir."}),(0,s.jsx)("div",{className:"text-muted small mt-2",children:"Bu işlem backend’de email template + notification tetikler."})]}),(0,s.jsxs)("div",{className:"modal-footer",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:L,disabled:_,children:"Vazgeç"}),(0,s.jsx)("button",{type:"button",className:"btn btn-sm "+("accept"===R?"btn-success":"btn-danger"),onClick:()=>void q(),disabled:_,children:_?"İşleniyor...":"accept"===R?"Kabul Et":"Reddet"})]})]})})}):null;return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header py-2",children:(0,s.jsxs)("div",{className:"d-flex align-items-center justify-content-between gap-2 flex-wrap",children:[(0,s.jsx)("span",{className:"small fw-semibold",children:"Randevu Listesi"}),(0,s.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,s.jsxs)("div",{className:"btn-group btn-group-sm",role:"group",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-outline-secondary"+("table"===k?" active":""),onClick:()=>w("table"),children:"Tablo"}),(0,s.jsx)("button",{type:"button",className:"btn btn-outline-secondary"+("cards"===k?" active":""),onClick:()=>w("cards"),children:"Kart"})]}),_?(0,s.jsx)("span",{className:"badge bg-secondary small",children:"Yükleniyor..."}):null]})]})}),(0,s.jsx)("div",{className:"card-body p-0",children:"table"===k?i?(0,s.jsxs)("div",{className:"table-responsive",children:[(0,s.jsxs)("table",{className:"table table-hover table-sm mb-0 align-middle",children:[(0,s.jsx)("thead",{className:"table-light",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-muted",children:"Durum"}),(0,s.jsx)("th",{children:"Müşteri"}),(0,s.jsx)("th",{children:"Tarih"}),(0,s.jsx)("th",{children:"Kaynak"}),(0,s.jsx)("th",{children:"Servis"}),(0,s.jsx)("th",{className:"text-end text-nowrap",children:"İşlemler"})]})}),(0,s.jsx)("tbody",{children:l.map(e=>{let a=1===Number(e.is_read??0)||!0===e.is_read;return(0,s.jsxs)("tr",{className:a?"":"table-warning",children:[(0,s.jsxs)("td",{className:"text-nowrap",children:[(0,s.jsx)("span",{className:`badge ${u(e.status)}`,children:m(e.status)}),a?null:(0,s.jsx)("span",{className:"badge bg-warning ms-2",children:"Okunmadı"})]}),(0,s.jsxs)("td",{children:[(0,s.jsx)("div",{className:"fw-semibold text-truncate",style:{maxWidth:260},children:e.name||"-"}),(0,s.jsxs)("div",{className:"text-muted small text-truncate",style:{maxWidth:260},children:[e.email||""," ",e.phone?`• ${e.phone}`:""]})]}),(0,s.jsx)("td",{className:"text-nowrap small",children:c(e.appointment_date,e.appointment_time)}),(0,s.jsx)("td",{className:"small text-truncate",style:{maxWidth:220},children:e.resource_title?e.resource_title:(0,s.jsx)("span",{className:"text-muted",children:"—"})}),(0,s.jsx)("td",{className:"small text-truncate",style:{maxWidth:220},children:e.service_title?e.service_title:(0,s.jsx)("span",{className:"text-muted",children:"—"})}),(0,s.jsx)("td",{className:"text-end text-nowrap",children:(0,s.jsxs)("div",{className:"btn-group btn-group-sm",role:"group",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-outline-success btn-sm",onClick:()=>D("accept",e),disabled:_||!b(e),title:b(e)?"Kabul et":'Sadece "Yeni" talepler kabul edilebilir.',children:"Kabul"}),(0,s.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>D("reject",e),disabled:_||!h(e),title:h(e)?"Reddet":"Bu durum reddedilemez.",children:"Red"}),(0,s.jsx)(d.default,{href:`/admin/bookings/${encodeURIComponent(e.id)}`,className:"btn btn-outline-primary btn-sm",children:"Düzenle"}),(0,s.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>void M(e),disabled:_||a,title:a?"Zaten okundu":"Okundu işaretle",children:"Okundu"}),(0,s.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>void $(e),disabled:_,children:"Sil"})]})})]},e.id)})})]}),(0,s.jsx)(Y,{})]}):W():i?(0,s.jsx)("div",{className:"p-3",children:(0,s.jsx)("div",{className:"row g-3",children:l.map(e=>{let a=1===Number(e.is_read??0)||!0===e.is_read;return(0,s.jsxs)("div",{className:"col-12 col-xxl-6",children:[(0,s.jsx)("div",{className:"border rounded-3 bg-white h-100 p-3",children:(0,s.jsxs)("div",{className:"d-flex align-items-start justify-content-between gap-3",children:[(0,s.jsxs)("div",{style:{minWidth:0},children:[(0,s.jsxs)("div",{className:"d-flex align-items-center gap-2 flex-wrap",children:[(0,s.jsx)("span",{className:`badge ${u(e.status)}`,children:m(e.status)}),a?null:(0,s.jsx)("span",{className:"badge bg-warning",children:"Okunmadı"}),(0,s.jsx)("span",{className:"badge bg-light text-dark border",children:c(e.appointment_date,e.appointment_time)})]}),(0,s.jsx)("div",{className:"fw-semibold mt-2 text-truncate",title:o(e.name),children:e.name||"-"}),(0,s.jsx)("div",{className:"text-muted small text-truncate",title:o(e.email),children:e.email||"-"}),e.customer_message?(0,s.jsx)("div",{className:"small mt-2",children:String(e.customer_message).slice(0,140)}):null,(0,s.jsxs)("div",{className:"text-muted small mt-2",children:["Kaynak: ",e.resource_title||"—"]}),(0,s.jsxs)("div",{className:"text-muted small",children:["Servis: ",e.service_title||"—"]})]}),(0,s.jsx)("div",{style:{width:180},children:(0,s.jsxs)("div",{className:"btn-group-vertical w-100",role:"group",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-outline-success btn-sm",onClick:()=>D("accept",e),disabled:_||!b(e),children:"Kabul"}),(0,s.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>D("reject",e),disabled:_||!h(e),children:"Red"}),(0,s.jsx)(d.default,{href:`/admin/bookings/${encodeURIComponent(e.id)}`,className:"btn btn-outline-primary btn-sm",children:"Düzenle"}),(0,s.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>void M(e),disabled:_||a,children:"Okundu"}),(0,s.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>void $(e),disabled:_,children:"Sil"})]})})]})}),(0,s.jsx)(Y,{})]},e.id)})})}):W()})]})};function p(){let e,d,r,c,o,m,u=(0,a.c)(21),{copy:b}=(0,l.useAdminUiCopy)();b.pages?.bookings,u[0]===Symbol.for("react.memo_cache_sentinel")?(e={q:"",status:"all",is_read:"all",appointment_date:"",resource_id:"",service_id:""},u[0]=e):e=u[0];let[h,p]=t.useState(e),j=h.q||void 0,g="all"===h.status?void 0:h.status,v="all"===h.is_read?void 0:"read"===h.is_read,N=h.appointment_date||void 0,y=h.resource_id||void 0,f=h.service_id||void 0;u[1]!==j||u[2]!==g||u[3]!==v||u[4]!==N||u[5]!==y||u[6]!==f?(d={q:j,status:g,is_read:v,appointment_date:N,resource_id:y,service_id:f,limit:200},u[1]=j,u[2]=g,u[3]=v,u[4]=N,u[5]=y,u[6]=f,u[7]=d):d=u[7];let _=d,{data:k,isLoading:w,refetch:S}=(0,n.useListBookingsAdminQuery)(_);u[8]!==k?(r=void 0===k?[]:k,u[8]=k,u[9]=r):r=u[9];let C=r;return u[10]!==C.length||u[11]!==h||u[12]!==w||u[13]!==S?(c=(0,s.jsx)(i,{filters:h,total:C.length,loading:w,onFiltersChange:p,onRefresh:S}),u[10]=C.length,u[11]=h,u[12]=w,u[13]=S,u[14]=c):c=u[14],u[15]!==C||u[16]!==w?(o=(0,s.jsx)(x,{items:C,loading:w}),u[15]=C,u[16]=w,u[17]=o):o=u[17],u[18]!==c||u[19]!==o?(m=(0,s.jsxs)("div",{className:"space-y-6",children:[c,o]}),u[18]=c,u[19]=o,u[20]=m):m=u[20],m}e.s(["default",()=>p],20333)}]);