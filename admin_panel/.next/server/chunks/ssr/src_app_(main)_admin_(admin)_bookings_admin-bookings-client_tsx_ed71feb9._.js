module.exports=[39620,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(1664);a.i(58501);var e=a.i(94560);let f=({filters:a,total:c,loading:d,onFiltersChange:e,onRefresh:f})=>{let g=b=>c=>{e({...a,[b]:c.target.value})};return(0,b.jsx)("div",{className:"card mb-3",children:(0,b.jsx)("div",{className:"card-body py-3",children:(0,b.jsxs)("div",{className:"d-flex flex-column flex-lg-row justify-content-between gap-3",children:[(0,b.jsxs)("div",{style:{minWidth:0,flex:2},children:[(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)("h5",{className:"mb-0 small fw-semibold",children:"Randevular"}),(0,b.jsx)("div",{className:"text-muted small",children:"Filtrele, görüntüle ve durum güncelle."})]}),(0,b.jsxs)("div",{className:"row g-2 align-items-end",children:[(0,b.jsxs)("div",{className:"col-md-4",children:[(0,b.jsx)("label",{className:"form-label small mb-1",children:"Arama"}),(0,b.jsx)("input",{type:"search",className:"form-control form-control-sm",placeholder:"İsim / Email / Telefon",value:a.q,onChange:g("q")})]}),(0,b.jsxs)("div",{className:"col-md-2",children:[(0,b.jsx)("label",{className:"form-label small mb-1",children:"Durum"}),(0,b.jsxs)("select",{className:"form-select form-select-sm",value:a.status,onChange:g("status"),children:[(0,b.jsx)("option",{value:"all",children:"Hepsi"}),(0,b.jsx)("option",{value:"new",children:"Yeni"}),(0,b.jsx)("option",{value:"confirmed",children:"Onaylandı"}),(0,b.jsx)("option",{value:"rejected",children:"Reddedildi"}),(0,b.jsx)("option",{value:"completed",children:"Tamamlandı"}),(0,b.jsx)("option",{value:"cancelled",children:"İptal"}),(0,b.jsx)("option",{value:"expired",children:"Süresi Doldu"})]})]}),(0,b.jsxs)("div",{className:"col-md-2",children:[(0,b.jsx)("label",{className:"form-label small mb-1",children:"Okunma"}),(0,b.jsxs)("select",{className:"form-select form-select-sm",value:a.is_read,onChange:g("is_read"),children:[(0,b.jsx)("option",{value:"all",children:"Hepsi"}),(0,b.jsx)("option",{value:"unread",children:"Okunmadı"}),(0,b.jsx)("option",{value:"read",children:"Okundu"})]})]}),(0,b.jsxs)("div",{className:"col-md-2",children:[(0,b.jsx)("label",{className:"form-label small mb-1",children:"Tarih"}),(0,b.jsx)("input",{type:"date",className:"form-control form-control-sm",value:a.appointment_date,onChange:g("appointment_date")})]}),(0,b.jsxs)("div",{className:"col-md-1",children:[(0,b.jsx)("label",{className:"form-label small mb-1",children:"Kaynak"}),(0,b.jsx)("input",{className:"form-control form-control-sm",value:a.resource_id,onChange:g("resource_id"),placeholder:"(ops.)"})]}),(0,b.jsxs)("div",{className:"col-md-1",children:[(0,b.jsx)("label",{className:"form-label small mb-1",children:"Servis"}),(0,b.jsx)("input",{className:"form-control form-control-sm",value:a.service_id,onChange:g("service_id"),placeholder:"(ops.)"})]})]})]}),(0,b.jsxs)("div",{className:"border-start ps-lg-3 ms-lg-3 d-flex flex-column justify-content-between",style:{minWidth:0,flex:1},children:[(0,b.jsxs)("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"small fw-semibold",children:"Toplam"}),(0,b.jsx)("div",{className:"display-6 fs-4 fw-bold",children:c})]}),f?(0,b.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:f,disabled:d,children:"Yenile"}):null]}),(0,b.jsx)("div",{className:"d-flex justify-content-end",children:d?(0,b.jsx)("span",{className:"badge bg-secondary small",children:"Yükleniyor..."}):null})]})]})})})};var g=a.i(38246),h=a.i(23292);let i=(a,b)=>{let c=String(a||"").trim(),d=String(b||"").trim();return c||d?c&&d?`${c} ${d}`:c||d:"-"},j=a=>null==a?"":String(a),k=a=>{let b=String(a||"").toLowerCase();return"new"===b?"Yeni":"confirmed"===b?"Onaylandı":"completed"===b?"Tamamlandı":"rejected"===b?"Reddedildi":"cancelled"===b?"İptal":"expired"===b?"Süresi Doldu":b?String(a):"-"},l=a=>{let b=String(a||"").toLowerCase();return"new"===b?"bg-primary-subtle text-primary border border-primary-subtle":"confirmed"===b?"bg-success-subtle text-success border border-success-subtle":"completed"===b?"bg-secondary-subtle text-secondary border border-secondary-subtle":"rejected"===b?"bg-warning-subtle text-warning border border-warning-subtle":"cancelled"===b?"bg-danger-subtle text-danger border border-danger-subtle":"expired"===b?"bg-dark-subtle text-dark border border-dark-subtle":"bg-light text-dark border"},m=a=>"new"===String(a.status||"").toLowerCase(),n=a=>{let b=String(a.status||"").toLowerCase();return"new"===b||"confirmed"===b},o=({items:a,loading:d})=>{let f=a??[],o=f.length>0,[p,{isLoading:q}]=(0,e.useDeleteBookingAdminMutation)(),[r,{isLoading:s}]=(0,e.useMarkBookingReadAdminMutation)(),[t,{isLoading:u}]=(0,e.useAcceptBookingAdminMutation)(),[v,{isLoading:w}]=(0,e.useRejectBookingAdminMutation)(),x=d||q||s||u||w,[y,z]=(0,c.useState)("table"),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)("accept"),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(""),I=(a,b)=>{D(a),F(b),H(String(b?.decision_note??"").trim()),B(!0)},J=()=>{B(!1),F(null),H("")},K=async a=>{if(window.confirm(`Bu randevu kaydını silmek \xfczeresin.

M\xfcşteri: ${a.name||"-"}
Tarih: ${i(a.appointment_date,a.appointment_time)}

Devam etmek istiyor musun?`))try{await p(a.id).unwrap(),h.toast.success("Randevu silindi.")}catch(a){h.toast.error(a?.data?.error?.message||a?.message||"Silme sırasında hata oluştu.")}},L=async a=>{try{await r(a.id).unwrap(),h.toast.success("Okundu olarak işaretlendi.")}catch(a){h.toast.error(a?.data?.error?.message||a?.message||"İşlem sırasında hata oluştu.")}},M=async()=>{if(!E)return;let a=String(G||"").trim();try{if("accept"===C)await t({id:E.id,body:a?{decision_note:a}:{}}).unwrap(),h.toast.success("Randevu kabul edildi. (Email + bildirim tetiklendi)");else{if(!window.confirm("Randevuyu reddetmek üzeresin. Devam edilsin mi?"))return;await v({id:E.id,body:a?{decision_note:a}:{}}).unwrap(),h.toast.success("Randevu reddedildi. (Email + bildirim tetiklendi)")}J()}catch(a){h.toast.error(a?.data?.error?.message||a?.message||"İşlem sırasında hata oluştu.")}},N=()=>d?(0,b.jsx)("div",{className:"text-muted small p-3",children:"Yükleniyor..."}):(0,b.jsx)("div",{className:"text-muted small p-3",children:"Kayıt bulunamadı."}),O=()=>A&&E?(0,b.jsx)("div",{className:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.35)"},role:"dialog","aria-modal":"true",children:(0,b.jsx)("div",{className:"modal-dialog modal-dialog-centered",children:(0,b.jsxs)("div",{className:"modal-content",children:[(0,b.jsxs)("div",{className:"modal-header py-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"fw-semibold",children:"accept"===C?"Randevu Kabul":"Randevu Red"}),(0,b.jsxs)("div",{className:"text-muted small",children:[E.name||"-"," • ",i(E.appointment_date,E.appointment_time)]})]}),(0,b.jsx)("button",{type:"button",className:"btn-close",onClick:J})]}),(0,b.jsxs)("div",{className:"modal-body",children:[(0,b.jsx)("label",{className:"form-label small mb-1",children:"Decision Note (opsiyonel)"}),(0,b.jsx)("textarea",{className:"form-control",rows:4,value:G,onChange:a=>H(a.target.value),disabled:x,placeholder:"Müşteriye gidecek template içinde gösterilebilir."}),(0,b.jsx)("div",{className:"text-muted small mt-2",children:"Bu işlem backend’de email template + notification tetikler."})]}),(0,b.jsxs)("div",{className:"modal-footer",children:[(0,b.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:J,disabled:x,children:"Vazgeç"}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm "+("accept"===C?"btn-success":"btn-danger"),onClick:()=>void M(),disabled:x,children:x?"İşleniyor...":"accept"===C?"Kabul Et":"Reddet"})]})]})})}):null;return(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"card-header py-2",children:(0,b.jsxs)("div",{className:"d-flex align-items-center justify-content-between gap-2 flex-wrap",children:[(0,b.jsx)("span",{className:"small fw-semibold",children:"Randevu Listesi"}),(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,b.jsxs)("div",{className:"btn-group btn-group-sm",role:"group",children:[(0,b.jsx)("button",{type:"button",className:"btn btn-outline-secondary"+("table"===y?" active":""),onClick:()=>z("table"),children:"Tablo"}),(0,b.jsx)("button",{type:"button",className:"btn btn-outline-secondary"+("cards"===y?" active":""),onClick:()=>z("cards"),children:"Kart"})]}),x?(0,b.jsx)("span",{className:"badge bg-secondary small",children:"Yükleniyor..."}):null]})]})}),(0,b.jsx)("div",{className:"card-body p-0",children:"table"===y?o?(0,b.jsxs)("div",{className:"table-responsive",children:[(0,b.jsxs)("table",{className:"table table-hover table-sm mb-0 align-middle",children:[(0,b.jsx)("thead",{className:"table-light",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-muted",children:"Durum"}),(0,b.jsx)("th",{children:"Müşteri"}),(0,b.jsx)("th",{children:"Tarih"}),(0,b.jsx)("th",{children:"Kaynak"}),(0,b.jsx)("th",{children:"Servis"}),(0,b.jsx)("th",{className:"text-end text-nowrap",children:"İşlemler"})]})}),(0,b.jsx)("tbody",{children:f.map(a=>{let c=1===Number(a.is_read??0)||!0===a.is_read;return(0,b.jsxs)("tr",{className:c?"":"table-warning",children:[(0,b.jsxs)("td",{className:"text-nowrap",children:[(0,b.jsx)("span",{className:`badge ${l(a.status)}`,children:k(a.status)}),c?null:(0,b.jsx)("span",{className:"badge bg-warning ms-2",children:"Okunmadı"})]}),(0,b.jsxs)("td",{children:[(0,b.jsx)("div",{className:"fw-semibold text-truncate",style:{maxWidth:260},children:a.name||"-"}),(0,b.jsxs)("div",{className:"text-muted small text-truncate",style:{maxWidth:260},children:[a.email||""," ",a.phone?`• ${a.phone}`:""]})]}),(0,b.jsx)("td",{className:"text-nowrap small",children:i(a.appointment_date,a.appointment_time)}),(0,b.jsx)("td",{className:"small text-truncate",style:{maxWidth:220},children:a.resource_title?a.resource_title:(0,b.jsx)("span",{className:"text-muted",children:"—"})}),(0,b.jsx)("td",{className:"small text-truncate",style:{maxWidth:220},children:a.service_title?a.service_title:(0,b.jsx)("span",{className:"text-muted",children:"—"})}),(0,b.jsx)("td",{className:"text-end text-nowrap",children:(0,b.jsxs)("div",{className:"btn-group btn-group-sm",role:"group",children:[(0,b.jsx)("button",{type:"button",className:"btn btn-outline-success btn-sm",onClick:()=>I("accept",a),disabled:x||!m(a),title:m(a)?"Kabul et":'Sadece "Yeni" talepler kabul edilebilir.',children:"Kabul"}),(0,b.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>I("reject",a),disabled:x||!n(a),title:n(a)?"Reddet":"Bu durum reddedilemez.",children:"Red"}),(0,b.jsx)(g.default,{href:`/admin/bookings/${encodeURIComponent(a.id)}`,className:"btn btn-outline-primary btn-sm",children:"Düzenle"}),(0,b.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>void L(a),disabled:x||c,title:c?"Zaten okundu":"Okundu işaretle",children:"Okundu"}),(0,b.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>void K(a),disabled:x,children:"Sil"})]})})]},a.id)})})]}),(0,b.jsx)(O,{})]}):N():o?(0,b.jsx)("div",{className:"p-3",children:(0,b.jsx)("div",{className:"row g-3",children:f.map(a=>{let c=1===Number(a.is_read??0)||!0===a.is_read;return(0,b.jsxs)("div",{className:"col-12 col-xxl-6",children:[(0,b.jsx)("div",{className:"border rounded-3 bg-white h-100 p-3",children:(0,b.jsxs)("div",{className:"d-flex align-items-start justify-content-between gap-3",children:[(0,b.jsxs)("div",{style:{minWidth:0},children:[(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2 flex-wrap",children:[(0,b.jsx)("span",{className:`badge ${l(a.status)}`,children:k(a.status)}),c?null:(0,b.jsx)("span",{className:"badge bg-warning",children:"Okunmadı"}),(0,b.jsx)("span",{className:"badge bg-light text-dark border",children:i(a.appointment_date,a.appointment_time)})]}),(0,b.jsx)("div",{className:"fw-semibold mt-2 text-truncate",title:j(a.name),children:a.name||"-"}),(0,b.jsx)("div",{className:"text-muted small text-truncate",title:j(a.email),children:a.email||"-"}),a.customer_message?(0,b.jsx)("div",{className:"small mt-2",children:String(a.customer_message).slice(0,140)}):null,(0,b.jsxs)("div",{className:"text-muted small mt-2",children:["Kaynak: ",a.resource_title||"—"]}),(0,b.jsxs)("div",{className:"text-muted small",children:["Servis: ",a.service_title||"—"]})]}),(0,b.jsx)("div",{style:{width:180},children:(0,b.jsxs)("div",{className:"btn-group-vertical w-100",role:"group",children:[(0,b.jsx)("button",{type:"button",className:"btn btn-outline-success btn-sm",onClick:()=>I("accept",a),disabled:x||!m(a),children:"Kabul"}),(0,b.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>I("reject",a),disabled:x||!n(a),children:"Red"}),(0,b.jsx)(g.default,{href:`/admin/bookings/${encodeURIComponent(a.id)}`,className:"btn btn-outline-primary btn-sm",children:"Düzenle"}),(0,b.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>void L(a),disabled:x||c,children:"Okundu"}),(0,b.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>void K(a),disabled:x,children:"Sil"})]})})]})}),(0,b.jsx)(O,{})]},a.id)})})}):N()})]})};function p(){let{copy:a}=(0,d.useAdminUiCopy)();a.pages?.bookings;let[g,h]=c.useState({q:"",status:"all",is_read:"all",appointment_date:"",resource_id:"",service_id:""}),i=c.useMemo(()=>({q:g.q||void 0,status:"all"===g.status?void 0:g.status,is_read:"all"===g.is_read?void 0:"read"===g.is_read,appointment_date:g.appointment_date||void 0,resource_id:g.resource_id||void 0,service_id:g.service_id||void 0,limit:200}),[g]),{data:j=[],isLoading:k,refetch:l}=(0,e.useListBookingsAdminQuery)(i);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(f,{filters:g,total:j.length,loading:k,onFiltersChange:h,onRefresh:l}),(0,b.jsx)(o,{items:j,loading:k})]})}a.s(["default",()=>p],39620)}];

//# sourceMappingURL=src_app_%28main%29_admin_%28admin%29_bookings_admin-bookings-client_tsx_ed71feb9._.js.map