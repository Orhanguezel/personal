module.exports=[31760,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(23292),f=a.i(28551),g=a.i(90899),h=a.i(30637);a.i(58501);var i=a.i(15422),j=a.i(42737),k=a.i(1229);let l=({jsonModel:a,disabled:c,onChangeJson:d,onErrorChange:e})=>(0,b.jsx)("div",{className:"rounded-lg border bg-card p-3",children:(0,b.jsx)(k.AdminJsonEditor,{label:"FAQ JSON (create/update payload)",value:a,onChange:d,onErrorChange:e,disabled:c,height:380,helperText:(0,b.jsxs)("div",{className:"space-y-2 text-xs text-muted-foreground",children:[(0,b.jsxs)("div",{children:["Bu JSON, ",(0,b.jsx)("code",{children:"/admin/faqs"})," create / update isteklerine gönderilen payload ile uyumludur."]}),(0,b.jsxs)("div",{children:["Başlıca alanlar:",(0,b.jsxs)("ul",{className:"mb-0 mt-1 list-disc pl-5",children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("code",{children:"question"}),", ",(0,b.jsx)("code",{children:"answer"}),", ",(0,b.jsx)("code",{children:"slug"}),", ",(0,b.jsx)("code",{children:"locale"})]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("code",{children:"is_active"}),", ",(0,b.jsx)("code",{children:"display_order"})]})]})]}),(0,b.jsxs)("div",{children:["Not: JSON modunda ",(0,b.jsx)("code",{children:"locale"})," göndermezsen, seçili locale (form üstünden) kullanılır."]})]})})}),m=a=>String(a??"").trim().toLowerCase().replace("_","-").split("-")[0].trim(),n=(a,b=0)=>{let c="number"==typeof a?a:Number(String(a??""));return Number.isFinite(c)?c:b},o=(a,b)=>{let c=m(b||"de")||"de";if(!a)return{id:void 0,locale:c,is_active:!0,display_order:0,question:"",answer:"",slug:""};let d=((a,b="de")=>m(a?.locale_resolved??a?.locale??b)||m(b)||"de")(a,c);return{id:a.id,locale:d,is_active:!!Number(a.is_active??0),display_order:n(a.display_order,0),question:a.question??"",answer:a.answer??"",slug:a.slug??""}},p=a=>({question:a.question,answer:a.answer,slug:a.slug,locale:a.locale,is_active:a.is_active,display_order:a.display_order}),q=({mode:a,initialData:d,loading:f,saving:g,locales:h,localesLoading:k,defaultLocale:q,onLocaleChange:r,onSubmit:s,onCancel:t})=>{let u=m(q||"de")||"de",[v,w]=(0,c.useState)(o(d,u)),[x,y]=(0,c.useState)(!1),z=f||g,[A,B]=(0,i.useLazyGetFaqAdminQuery)(),C=(0,c.useRef)(0),[D,E]=(0,c.useState)("form"),[F,G]=(0,c.useState)(()=>p(v)),[H,I]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=o(d,u);w(a),y(!1),G(p(a)),I(null)},[d,u]),(0,c.useEffect)(()=>{v.locale||w(a=>({...a,locale:u}))},[v.locale,u]),(0,c.useEffect)(()=>{"form"===D&&(G(p(v)),I(null))},[v,D]);let J=async b=>{let c=m(b||u)||u;if(m(v.locale)===c)return void r?.(c);if(r?.(c),"create"===a||!d?.id)return void w(a=>({...a,locale:c}));let f=++C.current;w(a=>({...a,locale:c}));try{let a=await A({id:d.id,locale:c}).unwrap();if(f!==C.current)return;let b=o(a,u);b.locale=c,w(b),y(!1),"json"===D&&(G(p(b)),I(null))}catch(a){if(f!==C.current)return;404===(a?.status??a?.originalStatus)?e.toast.info("Seçilen dil için kayıt bulunamadı; bu dilde yeni içerik oluşturabilirsin."):e.toast.error("Seçilen dil için kayıt yüklenirken bir hata oluştu.")}},K=a=>{let b=a.question.trim(),c=a.answer.trim(),d=a.slug.trim();b&&c&&d?s({...a,locale:m(a.locale||u)||u,question:b,answer:c,slug:d,display_order:Number.isFinite(a.display_order)?a.display_order:0}):e.toast.error("Question, Answer ve Slug alanları zorunludur.")},L=(0,c.useMemo)(()=>(h??[]).map(a=>({value:m(a.value),label:a.label})),[h]),M=B.isLoading||B.isFetching,N=!z,O=!z;return(0,b.jsx)("form",{onSubmit:a=>{let b,c,d,f,g,h,i;if(a.preventDefault(),z)return;if("form"===D)return void K(v);if(H)return void e.toast.error("JSON geçersiz. Lütfen hatayı düzelt.");let j=(b=m(u||"de")||"de",c={...v??{id:void 0,locale:b,is_active:!0,display_order:0,question:"",answer:"",slug:""}},f=m((d=F??{}).locale??c.locale??b)||b,c.locale=f,void 0!==d.is_active&&(c.is_active=!!d.is_active),void 0!==d.display_order&&(c.display_order=n(d.display_order,0)),void 0!==d.question&&(c.question=String(d.question??"")),void 0!==d.answer&&(c.answer=String(d.answer??"")),void 0!==d.slug&&(c.slug=String(d.slug??"")),c);(g=j.question.trim(),h=j.answer.trim(),i=j.slug.trim(),g&&h&&i&&1)?(w(j),y(!0),K(j)):e.toast.error("JSON içinde Question, Answer ve Slug alanları zorunludur.")},className:"space-y-4",children:(0,b.jsxs)("div",{className:"rounded-lg border bg-card",children:[(0,b.jsx)("div",{className:"border-b p-3",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-start lg:justify-between",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-sm font-semibold",children:"create"===a?"Yeni FAQ Oluştur":"FAQ Düzenle"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"form"===D?"Locale, aktiflik, sıralama, soru/cevap ve slug alanlarını doldur.":"İstek payload’ını JSON olarak düzenle ve kaydet."})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{type:"button",className:["rounded-md border px-3 py-1 text-xs","form"===D?"bg-muted text-foreground":"bg-background text-muted-foreground",!O?"opacity-60":""].join(" "),onClick:()=>E("form"),disabled:!O,children:"Form"}),(0,b.jsx)("button",{type:"button",className:["rounded-md border px-3 py-1 text-xs","json"===D?"bg-muted text-foreground":"bg-background text-muted-foreground",!N?"opacity-60":""].join(" "),onClick:()=>{G(p(v)),I(null),E("json")},disabled:!N,children:"JSON"}),"json"===D?(0,b.jsx)("span",{className:"ml-2 text-[11px] text-muted-foreground",children:H?"JSON hatalı":"JSON hazır"}):null]}),(0,b.jsx)("div",{className:"h-4 w-px bg-border mx-1 hidden lg:block"}),t?(0,b.jsx)("button",{type:"button",className:"rounded-md border px-3 py-1 text-xs",onClick:t,disabled:z,children:"Geri"}):null,(0,b.jsx)("button",{type:"submit",className:"rounded-md bg-primary px-3 py-1 text-xs text-primary-foreground disabled:opacity-60",disabled:z,children:g?"create"===a?"Oluşturuluyor...":"Kaydediliyor...":"create"===a?"Oluştur":"Kaydet"}),f||M?(0,b.jsx)("span",{className:"rounded-full border px-2 py-0.5 text-[11px] text-muted-foreground",children:M?"Dil değiştiriliyor...":"Yükleniyor..."}):null]})]})}),(0,b.jsxs)("div",{className:"p-3 space-y-4",children:[(0,b.jsx)(j.AdminLocaleSelect,{value:v.locale,onChange:J,options:L,loading:!!k,disabled:z||!!k&&!L.length||M,label:"Dil"}),"json"===D?(0,b.jsx)(l,{jsonModel:F,disabled:z||M,onChangeJson:a=>G(a),onErrorChange:a=>I(a)}):(0,b.jsxs)("div",{className:"grid gap-4 lg:grid-cols-12",children:[(0,b.jsx)("div",{className:"lg:col-span-8 space-y-4",children:(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-3 space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{id:"is_active",type:"checkbox",className:"h-4 w-4",checked:v.is_active,onChange:a=>w(b=>({...b,is_active:a.target.checked})),disabled:z}),(0,b.jsx)("span",{children:"Aktif"})]}),(0,b.jsxs)("div",{className:"md:ml-auto w-full md:w-56",children:[(0,b.jsx)("label",{className:"mb-1 block text-xs text-muted-foreground",children:"Sıralama (display_order)"}),(0,b.jsx)("input",{type:"number",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:v.display_order,onChange:a=>w(b=>({...b,display_order:n(a.target.value,0)})),disabled:z})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"mb-1 block text-xs text-muted-foreground",children:"Question"}),(0,b.jsx)("input",{type:"text",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:v.question,onChange:a=>{let b=a.target.value;w(a=>{let c={...a,question:b};return x||(c.slug=(a=>{if(!a)return"";let b=a.trim(),c={ç:"c",Ç:"c",ğ:"g",Ğ:"g",ı:"i",I:"i",İ:"i",ö:"o",Ö:"o",ş:"s",Ş:"s",ü:"u",Ü:"u"};return(b=(b=b.split("").map(a=>c[a]??a).join("")).replace(/ß/g,"ss").replace(/ẞ/g,"ss")).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-")})(b)),c})},disabled:z,required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"mb-1 block text-xs text-muted-foreground",children:"Slug"}),(0,b.jsx)("input",{type:"text",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:v.slug,onFocus:()=>y(!0),onChange:a=>{y(!0),w(b=>({...b,slug:a.target.value}))},disabled:z,required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"mb-1 block text-xs text-muted-foreground",children:"Answer"}),(0,b.jsx)("textarea",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",rows:8,value:v.answer,onChange:a=>w(b=>({...b,answer:a.target.value})),disabled:z,required:!0})]})]})}),(0,b.jsx)("div",{className:"lg:col-span-4",children:(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-3 space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold",children:"Notlar"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"FAQ modülünde görsel/SEO alanı yok. Bu form sadece backend’deki faq alanlarını yönetir."}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["İstersen üstten ",(0,b.jsx)("code",{children:"JSON"})," moduna geçip payload’ı direkt düzenleyebilirsin."]}),d?.created_at?(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Oluşturulma: ",(0,b.jsx)("code",{children:d.created_at})]}):null,d?.updated_at?(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Güncelleme: ",(0,b.jsx)("code",{children:d.updated_at})]}):null]})})]})]})]})})};function r(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a)}function s({id:a}){let j=(0,d.useRouter)(),k="new"===String(a),{localeOptions:l,defaultLocaleFromDb:m,loading:n,fetching:o}=(0,f.useAdminLocales)(),p=c.useMemo(()=>(0,g.resolveAdminApiLocale)(l,m,"tr"),[l,m]),s=c.useMemo(()=>new Set((l??[]).map(a=>(0,h.localeShortClient)(a.value)).filter(Boolean)),[l]),[t,u]=c.useState("");c.useEffect(()=>{l&&0!==l.length&&u(a=>{let b=(0,h.localeShortClient)(a);return b&&s.has(b)?b:(0,h.localeShortClientOr)(p,"tr")})},[l,s,p]);let v=c.useMemo(()=>{let a=(0,h.localeShortClient)(t);return a&&s.has(a)?a:(0,h.localeShortClientOr)(p,"tr")},[t,s,p]),w=!n&&!o,x=(l?.length??0)>0,[y,z]=(0,i.useLazyGetFaqAdminQuery)(),[A,B]=c.useState(void 0);c.useEffect(()=>{let b=!0;return async function(){if(!w||!x)return;if(k)return B(void 0);let c=String(a||"");if(r(c))try{let a=await y({id:c,locale:v}).unwrap();if(!b)return;B(a)}catch{if(!b)return;B(void 0)}}(),()=>{b=!1}},[a,k,w,x,v,y]);let[C,D]=(0,i.useCreateFaqAdminMutation)(),[E,F]=(0,i.useUpdateFaqAdminMutation)(),G=n||o||z.isLoading||z.isFetching,H=D.isLoading||F.isLoading,I=G||H,J=c.useMemo(()=>(l??[]).map(a=>({value:String(a.value??""),label:String(a.label??a.value??"")})),[l]),K=k?"create":"edit",L=()=>j.push("/admin/faqs"),M=async b=>{try{let c=(0,h.localeShortClientOr)(b.locale||v||p,"tr");if(s.size>0&&!s.has((0,h.localeShortClient)(c)))return void e.toast.error("Geçerli bir locale seçilmedi. app_locales ve default_locale kontrol edin.");if("create"===K){let a={locale:c,is_active:+!!b.is_active,display_order:b.display_order??0,question:b.question.trim(),answer:b.answer.trim(),slug:b.slug.trim()},d=await C(a).unwrap(),f=String(d?.id??"").trim();if(!f||!r(f))return void e.toast.error("Oluşturuldu ama id dönmedi/UUID değil. Backend response'u kontrol et.");e.toast.success("FAQ başarıyla oluşturuldu."),j.replace(`/admin/faqs/${encodeURIComponent(f)}`),j.refresh();return}let d=A?.id||b.id||a;if(!d||!r(String(d)))return void e.toast.error("FAQ verisi yüklenemedi (id yok).");let f={locale:c,is_active:+!!b.is_active,display_order:b.display_order??0,question:b.question.trim(),answer:b.answer.trim(),slug:b.slug.trim()};await E({id:String(d),patch:f}).unwrap(),e.toast.success("FAQ güncellendi."),c!==v&&u(c)}catch(a){e.toast.error(function(a){let b=a?.data?.error?.message;if("string"==typeof b&&b.trim())return b;let c=a?.data?.message;if("string"==typeof c&&c.trim())return c;let d=a?.error;return"string"==typeof d&&d.trim()?d:"İşlem başarısız. Lütfen tekrar deneyin."}(a))}};return w&&!x?(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,b.jsx)("div",{className:"text-sm font-semibold",children:"Dil listesi bulunamadı"}),(0,b.jsxs)("div",{className:"mt-1 text-sm text-muted-foreground",children:[(0,b.jsx)("code",{children:"site_settings.app_locales"})," boş veya geçersiz. Önce Site Settings’ten dilleri ayarlayın."]})]}):k||r(String(a||""))?(0,b.jsx)(q,{mode:K,initialData:A,loading:I,saving:H,locales:J,localesLoading:n||o,defaultLocale:v||p||"tr",onLocaleChange:a=>u((0,h.localeShortClientOr)(a,"tr")),onSubmit:M,onCancel:L}):(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,b.jsx)("div",{className:"text-sm font-semibold",children:"Geçersiz ID"}),(0,b.jsxs)("div",{className:"mt-1 text-sm text-muted-foreground",children:["UUID değil: ",(0,b.jsx)("code",{children:String(a||"-")})]}),(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)("button",{className:"rounded-md border px-3 py-2 text-xs",onClick:L,children:"Listeye dön"})})]})}a.s(["default",()=>s],31760)}];

//# sourceMappingURL=src_app_%28main%29_admin_%28admin%29_faqs_admin-faqs-detail-client_tsx_c7f5b9ca._.js.map