{"version":3,"sources":["../../../../src/app/%28main%29/admin/%28admin%29/user-roles/_components/user-roles-client.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { toast } from 'sonner';\nimport { Plus, Trash2, RefreshCcw, Filter } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\n\nimport {\n  Select,\n  SelectTrigger,\n  SelectValue,\n  SelectContent,\n  SelectItem,\n} from '@/components/ui/select';\n\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';\n\nimport {\n  Table,\n  TableHeader,\n  TableHead,\n  TableRow,\n  TableBody,\n  TableCell,\n} from '@/components/ui/table';\n\nimport type { UserRoleName, UserRole, UserRolesListParams, AdminUserView } from '@/integrations/shared';\n\nimport {\n  useAdminUserRolesListQuery,\n  useAdminUserRoleCreateMutation,\n  useAdminUserRoleDeleteMutation,\n  useAdminListQuery,\n  useAdminGetQuery,\n} from '@/integrations/hooks';\nimport { useAdminT } from '@/app/(main)/admin/_components/common/useAdminT';\n\ntype UserOption = {\n  id: string; // UUID (UI’da gösterilmiyor)\n  name: string; // full_name\n};\n\nfunction chunk<T>(arr: T[], size: number): T[][] {\n  const out: T[][] = [];\n  for (let i = 0; i < arr.length; i += size) out.push(arr.slice(i, i + size));\n  return out;\n}\n\n/**\n * RTK hook ile \"programatik\" query tetikleyebilmek için:\n * - useAdminGetQuery sadece render içinde kullanılabilir.\n * - Biz ise eksik id’leri sırayla fetch edeceğiz.\n *\n * Bu yüzden bir \"queue\" yaklaşımı kullanıyoruz:\n * - queueId state’i => her seferinde tek kullanıcı GET çağrılır\n * - sonuç gelince cache’e alınır, sıradaki id’ye geçilir\n */\nexport default function UserRolesClient() {\n  const t = useAdminT();\n\n  function roleLabel(r: UserRoleName) {\n    if (r === 'admin') return t('admin.userRoles.roles.admin');\n    if (r === 'moderator') return t('admin.userRoles.roles.moderator');\n    return t('admin.userRoles.roles.user');\n  }\n\n  function userName(u: Pick<AdminUserView, 'full_name'>): string {\n    const name = String(u.full_name ?? '').trim();\n    return name.length ? name : t('admin.userRoles.user.unknown');\n  }\n\n  function getErrMessage(err: unknown): string {\n    const anyErr = err as any;\n\n    const m1 = anyErr?.data?.error?.message;\n    if (typeof m1 === 'string' && m1.trim()) return m1;\n\n    const m1b = anyErr?.data?.error;\n    if (typeof m1b === 'string' && m1b.trim()) return m1b;\n\n    const m2 = anyErr?.data?.message;\n    if (typeof m2 === 'string' && m2.trim()) return m2;\n\n    const m3 = anyErr?.error;\n    if (typeof m3 === 'string' && m3.trim()) return m3;\n\n    return t('admin.userRoles.errorFallback');\n  }\n\n  // ------------------------------------------------------------\n  // 1) Kullanıcı listesi: dropdown için (isim bazlı)\n  // ------------------------------------------------------------\n  const usersQ = useAdminListQuery(\n    {\n      limit: 200,\n      offset: 0,\n      sort: 'created_at',\n      order: 'desc',\n    },\n    { refetchOnMountOrArgChange: true },\n  );\n\n  const baseUserOptions = React.useMemo<UserOption[]>(() => {\n    const items: UserOption[] = (usersQ.data ?? []).map((u) => ({\n      id: u.id,\n      name: userName(u),\n    }));\n    items.sort((a, b) => a.name.localeCompare(b.name, 'tr'));\n    return items;\n  }, [usersQ.data]);\n\n  // ------------------------------------------------------------\n  // 2) Roller listesi + filtre\n  // ------------------------------------------------------------\n  const [filterUserId, setFilterUserId] = React.useState<string>('all');\n  const [role, setRole] = React.useState<UserRoleName | 'all'>('all');\n  const [limit, setLimit] = React.useState(50);\n\n  const params = React.useMemo<UserRolesListParams>(\n    () => ({\n      ...(filterUserId !== 'all' ? { user_id: filterUserId } : {}),\n      ...(role !== 'all' ? { role: role as UserRoleName } : {}),\n      order: 'created_at',\n      direction: 'desc',\n      limit,\n      offset: 0,\n    }),\n    [filterUserId, role, limit],\n  );\n\n  const rolesQ = useAdminUserRolesListQuery(params);\n\n  const [createRole, createState] = useAdminUserRoleCreateMutation();\n  const [deleteRole, deleteState] = useAdminUserRoleDeleteMutation();\n\n  // ------------------------------------------------------------\n  // 3) Local user cache: listte olmayan user_id’leri tamamlamak için\n  // ------------------------------------------------------------\n  const [userCache, setUserCache] = React.useState<Map<string, AdminUserView>>(() => new Map());\n\n  // usersQ.data geldikçe cache’i güncelle (listeden gelenler cache’e yazılsın)\n  React.useEffect(() => {\n    if (!usersQ.data?.length) return;\n    setUserCache((prev) => {\n      const next = new Map(prev);\n      for (const u of usersQ.data ?? []) next.set(u.id, u);\n      return next;\n    });\n  }, [usersQ.data]);\n\n  // ------------------------------------------------------------\n  // 4) Eksik user_id’leri tespit et\n  // ------------------------------------------------------------\n  const missingUserIds = React.useMemo(() => {\n    const ids = new Set<string>();\n    for (const r of rolesQ.data ?? []) {\n      if (!r?.user_id) continue;\n      const id = String(r.user_id);\n      // cache’de yoksa missing\n      if (!userCache.has(id)) ids.add(id);\n    }\n    return Array.from(ids);\n  }, [rolesQ.data, userCache]);\n\n  // ------------------------------------------------------------\n  // 5) Eksikleri sırayla fetch et (queue)\n  // ------------------------------------------------------------\n  const [queue, setQueue] = React.useState<string[]>([]);\n  const [queueId, setQueueId] = React.useState<string>('');\n\n  // missing list değişince queue’yu besle (zaten var olanları ekleme)\n  React.useEffect(() => {\n    if (!missingUserIds.length) return;\n    setQueue((prev) => {\n      const prevSet = new Set(prev);\n      const toAdd = missingUserIds.filter((id) => !prevSet.has(id));\n      return toAdd.length ? [...prev, ...toAdd] : prev;\n    });\n  }, [missingUserIds]);\n\n  // queueId boşsa sıradakini al\n  React.useEffect(() => {\n    if (queueId) return;\n    if (!queue.length) return;\n    setQueueId(queue[0]);\n    setQueue((prev) => prev.slice(1));\n  }, [queue, queueId]);\n\n  // Sıradaki id için adminGet çağır (skip ile kontrol)\n  const userGetQ = useAdminGetQuery(\n    { id: queueId },\n    { skip: !queueId, refetchOnMountOrArgChange: true },\n  );\n\n  // Sonuç gelince cache’e koy, queueId’yi boşalt (sıradakine geçsin)\n  React.useEffect(() => {\n    if (!queueId) return;\n\n    // hata da olsa döngüyü kilitlemeyelim\n    if (userGetQ.isError) {\n      // bu id için bir daha denemeyi istersen burada retry policy ekleriz\n      setQueueId('');\n      return;\n    }\n\n    if (userGetQ.data) {\n      setUserCache((prev) => {\n        const next = new Map(prev);\n        next.set(queueId, userGetQ.data as AdminUserView);\n        return next;\n      });\n      setQueueId('');\n    }\n  }, [queueId, userGetQ.data, userGetQ.isError]);\n\n  function userNameById(id: string): { text: string; status: 'ok' | 'loading' | 'missing' } {\n    const u = userCache.get(id);\n    if (u) return { text: userName(u), status: 'ok' };\n\n    // şu an fetch ediliyorsa loading\n    if (queueId === id && userGetQ.isFetching) return { text: t('admin.userRoles.user.loading'), status: 'loading' };\n\n    // kuyrukta bekliyorsa loading\n    if (queue.includes(id)) return { text: t('admin.userRoles.user.loading'), status: 'loading' };\n\n    // ne cache'de ne kuyrukta => muhtemelen bulunamadı / yetki / silinmiş\n    return { text: t('admin.userRoles.user.notFound'), status: 'missing' };\n  }\n\n  // ------------------------------------------------------------\n  // 6) Dropdown seçenekleri: cache + list (unique) -> isim\n  // ------------------------------------------------------------\n  const userOptions = React.useMemo<UserOption[]>(() => {\n    // Dropdown’da sadece tam isimli kullanıcılar gösterilsin\n    const items: UserOption[] = baseUserOptions.slice();\n\n    // rollerde geçen ama listte olmayanları da dropdown’a eklemeyelim (şimdilik)\n    // çünkü isimler yüklenene kadar \"Yükleniyor\" olabilir ve UX kötüleşir.\n    // İstersen: cache’e düşenleri dropdown’a ekleriz.\n\n    return items;\n  }, [baseUserOptions]);\n\n  // ------------------------------------------------------------\n  // 7) Yeni rol ekleme\n  // ------------------------------------------------------------\n  const [newUserId, setNewUserId] = React.useState<string>('');\n  const [newRole, setNewRole] = React.useState<UserRoleName>('user');\n\n  const busy =\n    rolesQ.isFetching ||\n    createState.isLoading ||\n    deleteState.isLoading ||\n    usersQ.isFetching ||\n    usersQ.isLoading ||\n    userGetQ.isFetching;\n\n  async function onCreate(e: React.FormEvent) {\n    e.preventDefault();\n    if (!newUserId) {\n      toast.error(t('admin.userRoles.create.selectUser'));\n      return;\n    }\n\n    try {\n      await createRole({ user_id: newUserId, role: newRole }).unwrap();\n      toast.success(t('admin.userRoles.create.added'));\n      setNewUserId('');\n      setNewRole('user');\n      rolesQ.refetch();\n    } catch (err) {\n      const msg = getErrMessage(err);\n      toast.error(msg === 'user_role_already_exists' ? t('admin.userRoles.create.alreadyExists') : msg);\n    }\n  }\n\n  async function onDelete(row: UserRole) {\n    const who = userNameById(row.user_id).text;\n    const confirmMsg = t('admin.userRoles.table.deleteConfirm', { user: who, role: roleLabel(row.role) });\n    if (!confirm(confirmMsg)) return;\n\n    try {\n      await deleteRole({ id: row.id }).unwrap();\n      toast.success(t('admin.userRoles.table.deleted'));\n      rolesQ.refetch();\n    } catch (err) {\n      toast.error(getErrMessage(err));\n    }\n  }\n\n  // ------------------------------------------------------------\n  // UI\n  // ------------------------------------------------------------\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-1\">\n        <h1 className=\"text-lg font-semibold\">{t('admin.userRoles.title')}</h1>\n        <p className=\"text-sm text-muted-foreground\">\n          {t('admin.userRoles.description')}\n        </p>\n      </div>\n\n      {/* ---------------- Yeni Rol Ekle ---------------- */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">{t('admin.userRoles.create.title')}</CardTitle>\n          <CardDescription>{t('admin.userRoles.create.description')}</CardDescription>\n        </CardHeader>\n\n        <CardContent>\n          <form onSubmit={onCreate} className=\"grid gap-3 md:grid-cols-3 md:items-end\">\n            <div className=\"space-y-2 md:col-span-2\">\n              <Label>{t('admin.userRoles.create.userLabel')}</Label>\n\n              <Select value={newUserId} onValueChange={(v) => setNewUserId(v)} disabled={busy}>\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue\n                    placeholder={usersQ.isFetching ? t('admin.userRoles.create.usersLoading') : t('admin.userRoles.create.userPlaceholder')}\n                  />\n                </SelectTrigger>\n                <SelectContent>\n                  {userOptions.map((u) => (\n                    <SelectItem key={u.id} value={u.id}>\n                      {u.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n\n              {usersQ.isError ? (\n                <div className=\"text-xs text-muted-foreground\">\n                  {t('admin.userRoles.create.usersLoadError')}{' '}\n                  <Button\n                    type=\"button\"\n                    variant=\"link\"\n                    className=\"px-1\"\n                    onClick={() => usersQ.refetch()}\n                  >\n                    {t('admin.userRoles.create.retryButton')}\n                  </Button>\n                </div>\n              ) : null}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>{t('admin.userRoles.create.roleLabel')}</Label>\n              <Select value={newRole} onValueChange={(v) => setNewRole(v as UserRoleName)} disabled={busy}>\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue placeholder={t('admin.userRoles.create.rolePlaceholder')} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"admin\">{t('admin.userRoles.roles.admin')}</SelectItem>\n                  <SelectItem value=\"moderator\">{t('admin.userRoles.roles.moderator')}</SelectItem>\n                  <SelectItem value=\"user\">{t('admin.userRoles.roles.user')}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"md:col-span-3 flex justify-end\">\n              <Button type=\"submit\" disabled={busy || !newUserId}>\n                <Plus className=\"mr-2 size-4\" />\n                {t('admin.userRoles.create.addButton')}\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n\n      {/* ---------------- Rol Listesi ---------------- */}\n      <Card>\n        <CardHeader className=\"gap-2\">\n          <CardTitle className=\"text-base\">{t('admin.userRoles.list.title')}</CardTitle>\n          <CardDescription>{t('admin.userRoles.list.description')}</CardDescription>\n        </CardHeader>\n\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex flex-col gap-3 lg:flex-row lg:items-end\">\n            {/* Kullanıcı filtresi: dropdown */}\n            <div className=\"flex-1 space-y-2\">\n              <Label>{t('admin.userRoles.list.userFilterLabel')}</Label>\n              <Select\n                value={filterUserId}\n                onValueChange={(v) => setFilterUserId(v)}\n                disabled={busy}\n              >\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue placeholder={t('admin.userRoles.list.all')} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t('admin.userRoles.list.all')}</SelectItem>\n                  {userOptions.map((u) => (\n                    <SelectItem key={u.id} value={u.id}>\n                      {u.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Rol filtresi */}\n            <div className=\"w-full space-y-2 lg:w-56\">\n              <Label>{t('admin.userRoles.list.roleFilterLabel')}</Label>\n              <Select value={role} onValueChange={(v) => setRole(v as UserRoleName | 'all')} disabled={busy}>\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue placeholder={t('admin.userRoles.list.all')} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t('admin.userRoles.list.all')}</SelectItem>\n                  <SelectItem value=\"admin\">{t('admin.userRoles.roles.admin')}</SelectItem>\n                  <SelectItem value=\"moderator\">{t('admin.userRoles.roles.moderator')}</SelectItem>\n                  <SelectItem value=\"user\">{t('admin.userRoles.roles.user')}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Limit */}\n            <div className=\"w-full space-y-2 lg:w-44\">\n              <Label>{t('admin.userRoles.list.limitLabel')}</Label>\n              <Select\n                value={String(limit)}\n                onValueChange={(v) => setLimit(Number(v))}\n                disabled={busy}\n              >\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"20\">20</SelectItem>\n                  <SelectItem value=\"50\">50</SelectItem>\n                  <SelectItem value=\"100\">100</SelectItem>\n                  <SelectItem value=\"200\">200</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Yenile */}\n            <div className=\"flex items-center gap-2\">\n              <Filter className=\"size-4 text-muted-foreground\" />\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                onClick={() => rolesQ.refetch()}\n                disabled={busy}\n                title={t('admin.userRoles.list.refreshButton')}\n              >\n                <RefreshCcw className=\"size-4\" />\n              </Button>\n            </div>\n          </div>\n\n          {rolesQ.isError ? (\n            <div className=\"rounded-md border p-4 text-sm\">\n              {t('admin.userRoles.list.loadError')}{' '}\n              <Button variant=\"link\" className=\"px-1\" onClick={() => rolesQ.refetch()}>\n                {t('admin.userRoles.list.retryButton')}\n              </Button>\n            </div>\n          ) : null}\n\n          <div className=\"rounded-md border\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>{t('admin.userRoles.table.userColumn')}</TableHead>\n                  <TableHead>{t('admin.userRoles.table.roleColumn')}</TableHead>\n                  <TableHead>{t('admin.userRoles.table.createdColumn')}</TableHead>\n                  <TableHead className=\"text-right\">{t('admin.userRoles.table.actionColumn')}</TableHead>\n                </TableRow>\n              </TableHeader>\n\n              <TableBody>\n                {(rolesQ.data ?? []).map((row) => {\n                  const u = userNameById(row.user_id);\n                  return (\n                    <TableRow key={row.id}>\n                      <TableCell className=\"text-sm\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"truncate font-medium\">{u.text}</span>\n                          {u.status === 'loading' ? (\n                            <Badge variant=\"secondary\">{t('admin.userRoles.table.loading')}</Badge>\n                          ) : null}\n                          {u.status === 'missing' ? (\n                            <Badge variant=\"outline\">{t('admin.userRoles.table.notFound')}</Badge>\n                          ) : null}\n                        </div>\n                      </TableCell>\n\n                      <TableCell>\n                        <Badge variant={row.role === 'admin' ? 'default' : 'secondary'}>\n                          {roleLabel(row.role)}\n                        </Badge>\n                      </TableCell>\n\n                      <TableCell className=\"text-muted-foreground\">\n                        {row.created_at ? new Date(row.created_at).toLocaleString() : '—'}\n                      </TableCell>\n\n                      <TableCell className=\"text-right\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"destructive\"\n                          onClick={() => onDelete(row)}\n                          disabled={busy}\n                        >\n                          <Trash2 className=\"mr-2 size-4\" />\n                          {t('admin.userRoles.table.deleteButton')}\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n\n                {!rolesQ.isFetching && (rolesQ.data?.length ?? 0) === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={4} className=\"py-10 text-center text-muted-foreground\">\n                      {t('admin.userRoles.list.noRecords')}\n                    </TableCell>\n                  </TableRow>\n                ) : null}\n              </TableBody>\n            </Table>\n          </div>\n\n          <div className=\"text-xs text-muted-foreground\">\n            {t('admin.userRoles.list.note')}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}