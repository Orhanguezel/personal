module.exports=[86576,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(23292),f=a.i(28790),g=a.i(41675),h=a.i(60246),i=a.i(70106);let j=(0,i.default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),k=(0,i.default)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var l=a.i(96221),m=a.i(68114),n=a.i(99570),o=a.i(66718),p=a.i(70430),q=a.i(91119),r=a.i(5084),s=a.i(75083),t=a.i(6015),u=a.i(80701);a.i(58501);var v=a.i(64780);function w(a){let b=a?.data?.error?.message;if("string"==typeof b&&b.trim())return b;let c=a?.data?.message;if("string"==typeof c&&c.trim())return c;let d=a?.error;return"string"==typeof d&&d.trim()?d:"İşlem başarısız. Lütfen tekrar deneyin."}function x(a){let b=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0");return`${b}-${c}-${d}`}function y(){let a=new Date;return{from:x(new Date(Date.now()-2592e6)),to:x(a)}}function z(a){let b=Number(a);return Number.isFinite(b)?new Intl.NumberFormat("tr-TR").format(b):"0"}function A(a){let b=Number(a);return Number.isFinite(b)?`${Math.round(1e4*b)/100}%`:"0%"}function B(){let a=(0,d.useRouter)(),i=(0,d.useSearchParams)(),x=c.useMemo(()=>{let a;return"users"===(a=(i.get("tab")??"kpi").toLowerCase())||"locations"===a?a:"kpi"},[i]),{from:B,to:D}=c.useMemo(()=>y(),[]),E=i.get("from")??B,F=i.get("to")??D,G=i.get("role")??"seller",[H,I]=c.useState(E),[J,K]=c.useState(F),[L,M]=c.useState(G);function N(b){var c;let d,e,f={tab:x,from:E,to:F,role:G,...b},g=(c={tab:f.tab,from:f.from||void 0,to:f.to||void 0,role:"users"===f.tab?f.role:void 0},d=new URLSearchParams,Object.entries(c).forEach(([a,b])=>{null!=b&&""!==b&&d.set(a,String(b))}),(e=d.toString())?`?${e}`:"");a.push(`/admin/dashboard/reports${g}`)}c.useEffect(()=>I(E),[E]),c.useEffect(()=>K(F),[F]),c.useEffect(()=>M(G),[G]);let O=c.useMemo(()=>({from:E,to:F}),[E,F]),P=(0,v.useAdminReportsKpiQuery)("kpi"===x?O:void 0,{skip:"kpi"!==x}),Q=(0,v.useAdminReportsUsersPerformanceQuery)("users"===x?{...O,role:G}:void 0,{skip:"users"!==x}),R=(0,v.useAdminReportsLocationsQuery)("locations"===x?O:void 0,{skip:"locations"!==x}),S=P.isFetching||Q.isFetching||R.isFetching,T=Array.isArray(P.data)?P.data:[],U=Array.isArray(Q.data)?Q.data:[],V=Array.isArray(R.data)?R.data:[],W=T.filter(a=>"day"===a.period),X=T.filter(a=>"week"===a.period),Y=T.filter(a=>"month"===a.period);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-end md:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("h1",{className:"text-lg font-semibold",children:"Raporlar (Admin)"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"KPI, kullanıcı performansı ve lokasyon kırılımı."})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)(n.Button,{type:"button",variant:"outline",onClick:()=>{"kpi"===x&&P.refetch(),"users"===x&&Q.refetch(),"locations"===x&&R.refetch()},disabled:S,title:"Yenile",children:[S?(0,b.jsx)(l.Loader2,{className:"mr-2 size-4 animate-spin"}):(0,b.jsx)(f.RefreshCcw,{className:"mr-2 size-4"}),"Yenile"]})})]}),(0,b.jsxs)(q.Card,{children:[(0,b.jsxs)(q.CardHeader,{className:"gap-2",children:[(0,b.jsx)(q.CardTitle,{className:"text-base",children:"Sekmeler"}),(0,b.jsx)(q.CardDescription,{children:"KPI • Kullanıcı Performansı • Lokasyonlar"})]}),(0,b.jsx)(q.CardContent,{children:(0,b.jsxs)(s.Tabs,{value:x,onValueChange:a=>N({tab:a}),children:[(0,b.jsxs)(s.TabsList,{className:"flex flex-wrap",children:[(0,b.jsxs)(s.TabsTrigger,{value:"kpi",className:"gap-2",children:[(0,b.jsx)(k,{className:"size-4"}),"KPI"]}),(0,b.jsxs)(s.TabsTrigger,{value:"users",className:"gap-2",children:[(0,b.jsx)(h.Users,{className:"size-4"}),"Kullanıcılar"]}),(0,b.jsxs)(s.TabsTrigger,{value:"locations",className:"gap-2",children:[(0,b.jsx)(j,{className:"size-4"}),"Lokasyonlar"]})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsxs)(q.Card,{className:"border-dashed",children:[(0,b.jsxs)(q.CardHeader,{className:"pb-3",children:[(0,b.jsx)(q.CardTitle,{className:"text-sm",children:"Filtre"}),(0,b.jsx)(q.CardDescription,{children:"Tarih aralığı (from/to) ve kullanıcı rolü."})]}),(0,b.jsx)(q.CardContent,{children:(0,b.jsxs)("form",{onSubmit:function(a){a.preventDefault();let b=H.trim(),c=J.trim();b&&Number.isNaN(new Date(b).getTime())?e.toast.error("from geçersiz tarih."):c&&Number.isNaN(new Date(c).getTime())?e.toast.error("to geçersiz tarih."):N({from:b,to:c,role:L})},className:"grid gap-3 lg:grid-cols-12",children:[(0,b.jsxs)("div",{className:"space-y-2 lg:col-span-4",children:[(0,b.jsx)(p.Label,{htmlFor:"from",children:"from"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(g.Calendar,{className:"pointer-events-none absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(o.Input,{id:"from",value:H,onChange:a=>I(a.target.value),className:"pl-9",placeholder:"YYYY-MM-DD",disabled:S})]})]}),(0,b.jsxs)("div",{className:"space-y-2 lg:col-span-4",children:[(0,b.jsx)(p.Label,{htmlFor:"to",children:"to"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(g.Calendar,{className:"pointer-events-none absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(o.Input,{id:"to",value:J,onChange:a=>K(a.target.value),className:"pl-9",placeholder:"YYYY-MM-DD",disabled:S})]})]}),(0,b.jsxs)("div",{className:(0,m.cn)("space-y-2 lg:col-span-3","users"!==x&&"opacity-60"),children:[(0,b.jsx)(p.Label,{children:"role"}),(0,b.jsxs)(u.Select,{value:L,onValueChange:a=>M(a),disabled:S||"users"!==x,children:[(0,b.jsx)(u.SelectTrigger,{children:(0,b.jsx)(u.SelectValue,{placeholder:"Rol"})}),(0,b.jsxs)(u.SelectContent,{children:[(0,b.jsx)(u.SelectItem,{value:"seller",children:"seller"}),(0,b.jsx)(u.SelectItem,{value:"driver",children:"driver"})]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Sadece “Kullanıcılar” sekmesinde kullanılır."})]}),(0,b.jsx)("div",{className:"flex gap-2 lg:col-span-1 lg:items-end",children:(0,b.jsx)(n.Button,{type:"submit",disabled:S,className:"w-full",children:"Uygula"})}),(0,b.jsx)("div",{className:"flex gap-2 lg:col-span-12",children:(0,b.jsx)(n.Button,{type:"button",variant:"outline",onClick:function(){let a=y();I(a.from),K(a.to),M("seller"),N({from:a.from,to:a.to,role:"seller"})},disabled:S,children:"Sıfırla"})})]})})]})}),(0,b.jsx)(r.Separator,{className:"my-5"}),(0,b.jsx)(s.TabsContent,{value:"kpi",className:"space-y-4",children:P.isError?(0,b.jsxs)("div",{className:"rounded-md border p-4 text-sm",children:["KPI yüklenemedi."," ",(0,b.jsx)(n.Button,{variant:"link",className:"px-1",onClick:()=>P.refetch(),children:"Yeniden dene"}),(0,b.jsx)("div",{className:"mt-1 text-xs text-muted-foreground",children:w(P.error)})]}):(0,b.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[(0,b.jsx)(C,{title:"Günlük",rows:W}),(0,b.jsx)(C,{title:"Haftalık",rows:X}),(0,b.jsx)(C,{title:"Aylık",rows:Y})]})}),(0,b.jsx)(s.TabsContent,{value:"users",className:"space-y-4",children:Q.isError?(0,b.jsxs)("div",{className:"rounded-md border p-4 text-sm",children:["Kullanıcı performansı yüklenemedi."," ",(0,b.jsx)(n.Button,{variant:"link",className:"px-1",onClick:()=>Q.refetch(),children:"Yeniden dene"}),(0,b.jsx)("div",{className:"mt-1 text-xs text-muted-foreground",children:w(Q.error)})]}):(0,b.jsxs)(q.Card,{children:[(0,b.jsxs)(q.CardHeader,{children:[(0,b.jsx)(q.CardTitle,{className:"text-base",children:"Kullanıcı Performansı"}),(0,b.jsxs)(q.CardDescription,{children:["role=",G," • kayıt: ",Q.isFetching?"—":U.length]})]}),(0,b.jsx)(q.CardContent,{children:(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(t.Table,{children:[(0,b.jsx)(t.TableHeader,{children:(0,b.jsxs)(t.TableRow,{children:[(0,b.jsx)(t.TableHead,{children:"User"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Orders"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Delivered"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Cancelled"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Chickens"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Success"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Incentive"})]})}),(0,b.jsxs)(t.TableBody,{children:[U.map(a=>{let c;return(0,b.jsxs)(t.TableRow,{children:[(0,b.jsx)(t.TableCell,{className:"font-medium",children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"truncate",children:a.user_id}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:a.role})]})}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.orders_total)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.delivered_orders)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.cancelled_orders)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.chickens_delivered)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:A(a.success_rate)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex flex-col items-end",children:[(0,b.jsx)("span",{className:"font-medium",children:Number.isFinite(c=Number(a.incentive_amount_total))?new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(c):"0"}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["del:",z(a.incentive_deliveries_count)," • ck:",z(a.incentive_chickens_count)]})]})})]},`${a.role}-${a.user_id}`)}),Q.isFetching||0!==U.length?null:(0,b.jsx)(t.TableRow,{children:(0,b.jsx)(t.TableCell,{colSpan:7,className:"py-10 text-center text-muted-foreground",children:"Kayıt bulunamadı."})})]})]})})})]})}),(0,b.jsx)(s.TabsContent,{value:"locations",className:"space-y-4",children:R.isError?(0,b.jsxs)("div",{className:"rounded-md border p-4 text-sm",children:["Lokasyon raporu yüklenemedi."," ",(0,b.jsx)(n.Button,{variant:"link",className:"px-1",onClick:()=>R.refetch(),children:"Yeniden dene"}),(0,b.jsx)("div",{className:"mt-1 text-xs text-muted-foreground",children:w(R.error)})]}):(0,b.jsxs)(q.Card,{children:[(0,b.jsxs)(q.CardHeader,{children:[(0,b.jsx)(q.CardTitle,{className:"text-base",children:"Lokasyon Kırılımı"}),(0,b.jsxs)(q.CardDescription,{children:["kayıt: ",R.isFetching?"—":V.length]})]}),(0,b.jsx)(q.CardContent,{children:(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(t.Table,{children:[(0,b.jsx)(t.TableHeader,{children:(0,b.jsxs)(t.TableRow,{children:[(0,b.jsx)(t.TableHead,{children:"Şehir"}),(0,b.jsx)(t.TableHead,{children:"İlçe"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Orders"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Delivered"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Cancelled"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Chickens"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Success"})]})}),(0,b.jsxs)(t.TableBody,{children:[V.map((a,c)=>(0,b.jsxs)(t.TableRow,{children:[(0,b.jsx)(t.TableCell,{className:"font-medium",children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"truncate",children:a.city_name??"—"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:a.city_id?`#${a.city_id.slice(0,8)}`:"—"})]})}),(0,b.jsx)(t.TableCell,{children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"truncate",children:a.district_name??"—"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:a.district_id?`#${a.district_id.slice(0,8)}`:"—"})]})}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.orders_total)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.delivered_orders)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.cancelled_orders)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.chickens_delivered)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:A(a.success_rate)})]},`${a.city_id??"null"}-${a.district_id??"null"}-${c}`)),R.isFetching||0!==V.length?null:(0,b.jsx)(t.TableRow,{children:(0,b.jsx)(t.TableCell,{colSpan:7,className:"py-10 text-center text-muted-foreground",children:"Kayıt bulunamadı."})})]})]})})})]})})]})})]})]})}function C(a){let{title:c,rows:d}=a;return(0,b.jsxs)(q.Card,{children:[(0,b.jsxs)(q.CardHeader,{className:"pb-3",children:[(0,b.jsx)(q.CardTitle,{className:"text-sm",children:c}),(0,b.jsxs)(q.CardDescription,{children:["Kayıt: ",d.length]})]}),(0,b.jsx)(q.CardContent,{children:(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(t.Table,{children:[(0,b.jsx)(t.TableHeader,{children:(0,b.jsxs)(t.TableRow,{children:[(0,b.jsx)(t.TableHead,{children:"Bucket"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Orders"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Delivered"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Chickens"}),(0,b.jsx)(t.TableHead,{className:"text-right",children:"Success"})]})}),(0,b.jsxs)(t.TableBody,{children:[d.map(a=>(0,b.jsxs)(t.TableRow,{children:[(0,b.jsx)(t.TableCell,{className:"font-medium",children:a.bucket}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.orders_total)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.delivered_orders)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:z(a.chickens_delivered)}),(0,b.jsx)(t.TableCell,{className:"text-right",children:A(a.success_rate)})]},`${a.period}-${a.bucket}`)),0===d.length?(0,b.jsx)(t.TableRow,{children:(0,b.jsx)(t.TableCell,{colSpan:5,className:"py-10 text-center text-muted-foreground",children:"Kayıt yok."})}):null]})]})})})]})}a.s(["default",()=>B],86576)}];

//# sourceMappingURL=b1a17_app_%28main%29_admin_%28admin%29_reports__components_admin-reports-client_tsx_bf55ee0d._.js.map